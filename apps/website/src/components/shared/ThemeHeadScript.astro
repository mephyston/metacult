<!-- Prevents Flash Of Unstyled Content (FOUC) for Dark Mode & Theme Color -->
<script is:inline>
    // Handles Dark Mode
    const getThemePreference = () => {
        if (
            typeof localStorage !== 'undefined' &&
            localStorage.getItem('theme')
        ) {
            return localStorage.getItem('theme');
        }
        return window.matchMedia('(prefers-color-scheme: dark)').matches
            ? 'dark'
            : 'light';
    };

    // Handles Color Theme (Claude vs Zinc)
    const getColorTheme = () => {
        if (
            typeof localStorage !== 'undefined' &&
            localStorage.getItem('theme-color')
        ) {
            return localStorage.getItem('theme-color');
        }
        return 'claude'; // Default
    };

    const isDark = getThemePreference() === 'dark';
    document.documentElement.classList[isDark ? 'add' : 'remove']('dark');

    // Set data-theme attribute
    const colorTheme = getColorTheme();
    document.documentElement.setAttribute('data-theme', colorTheme);

    if (typeof localStorage !== 'undefined') {
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.attributeName === 'class') {
                    const isDark =
                        document.documentElement.classList.contains('dark');
                    localStorage.setItem('theme', isDark ? 'dark' : 'light');
                }
                if (mutation.attributeName === 'data-theme') {
                    const theme =
                        document.documentElement.getAttribute('data-theme');
                    localStorage.setItem('theme-color', theme);
                }
            });
        });
        observer.observe(document.documentElement, {
            attributes: true,
            attributeFilter: ['class', 'data-theme'],
        });
    }
</script>
