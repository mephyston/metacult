---
import Layout from '../layouts/Layout.astro';
import { Hero } from '@metacult/shared-ui';
import { getImage } from 'astro:assets';
import heroImage from '../assets/hero.jpg';

// Basic Server-Side Data Fetching
let recentMedias = [];
try {
	const res = await fetch(
		`${import.meta.env.PUBLIC_API_URL}/api/media/recent`,
	);
	if (res.ok) {
		recentMedias = await res.json();
	} else {
		console.error('Failed to fetch recent media:', res.statusText);
	}
} catch (e) {
	console.error('Error fetching recent media:', e);
}

// Hero Content (Moved to variables to ensure clean strings)
const heroBadge = 'Nouvelle Version 2.0';
const heroHeading = 'Le Radar Social pour votre Culture.';
const heroDescription =
	'Découvrez, suivez et partagez vos films, jeux et séries préférés avec votre squad. Une seule app pour toute votre culture.';
const heroCtaText = 'Créer un compte';
const heroSecondaryCtaText = 'Se connecter';
const heroImageSizes =
	'(max-width: 768px) 100vw, (max-width: 1200px) 80vw, 1920px';

const heroBg = await getImage({
	src: heroImage,
	width: 1920,
	height: 1080,
	format: 'avif',
	quality: 85,
});
---

<Layout title="MetaCult - Le Radar Social">
	<!-- HERO SECTION -->
	<Hero
		client:idle
		badge={heroBadge}
		heading={heroHeading}
		description={heroDescription}
		ctaText={heroCtaText}
		ctaLink="/auth/register"
		secondaryCtaText={heroSecondaryCtaText}
		secondaryCtaLink="/auth/login"
		image={heroBg.src}
		imageSizes={heroImageSizes}
		fetchpriority="high"
		recentMedias={recentMedias}
	/>
</Layout>
